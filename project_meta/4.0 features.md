# CityPulse v4.0 - Crisis & Intervention System

## Overview
Version 4.0 introduces a sophisticated **Crisis & Intervention Loop** that models urban resilience. Instead of immediate binary outcomes, crises now persist as status effects that players must actively resolve with specific solution cards. This update also adds DMP2025-specific hard-choice cards and enhanced feedback mechanisms.

## Key Features

### 1. Persistent Crisis Status Effects
Crises no longer disappear immediately after acknowledgment. They persist and apply **per-turn penalties** until resolved:

| Crisis Event | Trigger Condition | Visual Effect (3D City) | Status Effect (Penalty per Turn) |
|--------------|-------------------|------------------------|--------------------------------|
| **Sumatra Squall** | Random + High probability in "Climate Siege" | Dark storm clouds, rain, rising water | -10 Happiness, -5 Budget |
| **Urban Heat Island** | 3+ consecutive "Urban Development" cards without green buffers | Orange tint, heat shimmer, brown foliage | -10 Health, -5 Budget |
| **Supply Chain Shock** | Random Global Event | Cargo ships disappear from harbour | -15 Happiness |

### 2. Solution Cards (Interventions)
New card type: `type: 'solution'`. These appear with higher frequency when the corresponding crisis is active:

#### For Flash Floods / Sumatra Squall:
- **"Deploy ABC Waters Strategy"**: Transforms concrete canals into natural rivers.
  - Cost: Moderate Budget
  - Benefit: Removes Flood status, +10 Happiness

#### For Urban Heat Island:
- **"Gazette Wind Corridors"**: Protects wind paths from tall buildings.
  - Cost: -15 Land
  - Benefit: Removes Heat Stress, +10 Health
- **"District Cooling System"**: Underground cooling infrastructure.
  - Cost: High Budget
  - Benefit: Removes Heat Stress, +5 Land

#### For Supply Chain Shock:
- **"Convert Rooftops to Vertical Farms"**: 30-by-30 food security goal.
  - Cost: Moderate Budget
  - Benefit: Removes Food Insecurity, +5 Resilience

### 3. DMP2025 Hard-Choice Cards

#### Turf City Transformation (Heritage vs. Housing)
- **Choice A (Inclusive)**: "Build first public HDB in Bukit Timah in 40 years."
  - Impact: +30 Social Equity, +20 Housing, -10 Wealthy Sentiment
- **Choice B (Heritage)**: "Conserve Grandstands as lifestyle hub."
  - Impact: +20 Heritage, +10 Happiness, -20 Housing

#### Long Island Reclamation (Climate vs. Conservation)
- **Choice A (Mega-Project)**: "Reclaim 3 islands for coastal protection."
  - Impact: -50 Budget, +40 Resilience, -10 Marine Biodiversity
- **Choice B (Retreat)**: "Plan for Managed Retreat."
  - Impact: -30 Land, -20 Happiness, +10 Budget

#### Golden Mile Complex Fate (Identity vs. Modernization)
- **Adaptive Reuse**: Save heritage but sacrifice efficiency
- **Demolish**: Higher density but lose cultural identity

### 4. Enhanced Citizen Voice Mechanic
Addresses "Perceived Tokenism" by making feedback meaningful:
- Text input field appears in bonus feedback mode
- Explicit message: "Your input helps shape the Youth Action Plan"
- Feedback is stored and displayed in Admin Dashboard

### 5. Enhanced ImpactLedger
The end-game summary now provides contextual real-world impact analysis:
- "You prioritized Biodiversity over Housing. In real life, this equals saving Dover Forest but extending BTO wait times by 2 years."
- Treats players as intellectual equals, not passive recipients

## Technical Implementation

### New Data Structures
```javascript
// Crisis state in GameEngine
const [activeCrises, setActiveCrises] = useState([]);
// Each crisis: { type: 'flood'|'heatwave'|'supply_shock', startTurn: number, resolved: false }

// Solution cards have a new property
{
  type: 'solution',
  resolves: 'flood', // Which crisis this solves
  ...
}
```

### Crisis System Logic
1. Crises trigger based on conditions (random, consecutive card patterns, or scenario)
2. While crisis is active, penalties apply each turn
3. Solution cards appear with boosted probability during active crisis
4. Playing a solution card removes the crisis status

### Visual Indicators
- HUD shows active crisis status with icon and penalty ticker
- 3D City maintains crisis visual effects until resolved
- Solution cards have distinct "SOLUTION" badge styling
