# v4.0 Development Log
**Date**: 2026-01-20
**Version**: 4.0 "Realism & Resilience"

---

## 1. Implementation Plan
# Implementation Plan - Phase 2 Features (Crisis System & UI Polish)

We are entering Phase 2 of development. The focus is to deepen the simulation loop (Crisis Intervention), enhance the user flow (Scenario Selection, Post-Game Interaction), and refine the UI for the 2.0 milestone.

## User Review Required

> [!IMPORTANT]
> **Persistent Crisis System**: Crises (Floods, Heatwaves) will now **persist** for multiple turns and drain resources every turn until a "Solution Card" is played. This makes the game significantly harder and stickier.

## Proposed Changes

### Core Gameplay Loop
#### [NEW] [crisisConfig.js](file:///c:/Users/Darius%20Koh/Documents/Y3S2/ProID/Prototype/src/data/crisisConfig.js)
- Define crisis types (Flood, Heatwave, Supply Shock).
- Define "Solution Cards" (cards that resolve specific crises).
- Define "Status Effects" (health/budget decay rates per turn).

#### [MODIFY] [GameEngine.jsx](file:///c:/Users/Darius%20Koh/Documents/Y3S2/ProID/Prototype/src/components/GameEngine.jsx)
- **State**: Add `activeCrises` array (supports multiple concurrent crises).
- **Logic**:
    - **Turn Start**: Apply penalty effects from `activeCrises` (e.g. -5 HP/turn).
    - **Card Draw**: If crisis is active, increase probability of drawing relevant "Solution Cards".
    - **Resolution**: Playing a Solution Card removes the crisis and grants a "Resilience Bonus".

### User Interface (UI)
#### [MODIFY] [HUD.jsx](file:///c:/Users/Darius%20Koh/Documents/Y3S2/ProID/Prototype/src/components/HUD.jsx)
- **Crisis Indicator**: Add "Active Status" icons under the resource bars (e.g. "Flood Warning: -5 Budget/Turn").
- **Visuals**: Add pulsing red/orange overlays to the screen edges during active crisis.

#### [MODIFY] [City3D.jsx](file:///c:/Users/Darius%20Koh/Documents/Y3S2/ProID/Prototype/src/components/City3D.jsx)
- **Dynamic Weather**: Render rain/stormclouds for Flood, heat shimmer for Heatwave.

### New Content
#### [MODIFY] [cards.js](file:///c:/Users/Darius%20Koh/Documents/Y3S2/ProID/Prototype/src/data/cards.js)
- **New Cards**: Add 3-5 "Solution Cards" (e.g. "Deploy ABC Waters", "Gazette Wind Corridors").
- **Crisis Trigger**: Add `resolves: 'flood'` property to solution cards.

## Verification Plan

### Automated Tests
- N/A (Manual Playtesting focus)

### Manual Verification
1.  **Scenario Test**: Start a game, force a crisis. Verify resources drain each turn.
2.  **Resolution Test**: Find a Solution Card, play it, verify crisis ends and city visuals return to normal.
3.  **UI Check**: Verify HUD status icons and 3D weather effects appear correctly.

---

## 2. Task List
# Task List

## Phase 2: Crisis System & UI Polish

- [/] **Core Systems**
  - [x] Create `src/data/crisisConfig.js`
  - [x] Update `GameEngine.jsx` State (`activeCrises`)
  - [x] Implement Per-Turn Penalty Logic
  - [x] Implement Solution Card Probability Boost
  - [x] **Verification**: Verify resources drain during crisis

- [/] **Scenario & Flow**
  - [x] Create `ScenarioIntro.jsx` screen
  - [x] Implement "Select Scenario" logic in `App.jsx` (`currentView: 'scenario'`)
  - [x] Define Scenarios (Standard, Aging, Climate) in `src/data/scenarioConfig.js`

- [/] **Visuals & Feedback (HUD)**
  - [x] Update `HUD.jsx` to show Active Crisis Icons
  - [x] Add "Status Effect" tickers (e.g. "-5/turn")
  - [x] Connect `City3D` to crisis state (Rain/Heat effects)
  - [x] **Refinement**: Move Crisis Indicators to center/bottom of HUD? (Complete: Added to bottom of HUD)

- [/] **Content Expansion**
  - [x] Add Solution Cards to `cards.js`
  - [x] Add 13 New DMP2025 Press Conference Cards
  - [x] Cap Press Conference cards to max 2 per game
  - [x] Implement "Trilemma" Logic (Budget/Social/Eco trade-offs)

- [/] **Final Polish**
  - [x] Update README.md with v4.0 Features
  - [x] **Bug Fix**: Fix HUD overlapping Avatar
  - [x] **Bug Fix**: Ensure "View City" button works on Mobile (Fixed z-index/camera)
  - [x] White text for Crisis Bubbles (readability)
  - [x] Prevent duplicate crisis spawning
  - [x] **Post-Game Feature**: Allow re-visiting 3D City from Main Menu (and Audit Log)
  - [x] **UI Polish**: Repositioned Map button, Added Score Overlay, Mobile Layout Fixes (Vertical Stack, Text Labels, 3D Camera Fit)

---

## 3. Walkthrough / Change Log
# Walkthrough - v4.0 Updates

## 1. Scenario Selection Screen
Previously, the game started immediately. Now, users are greeted with a **Scenario Selection Screen**:
- **Standard Run**: The classic balanced experience.
- **The Silver Tsunami**: An "Hard Mode" focusing on aging population (Health decay increased).
- **Climate Siege**: A survival mode with frequent environmental crises.

This immediately frames the user's mindset: "I am solving a specific problem."

## 2. Persistent Crisis System
The most significant change is the **Active Crisis Loop**.
- **Before**: A crisis card appeared, you swiped yes/no, it ended.
- **After (v4.0)**:
    1.  **Trigger**: A crisis (e.g., Heatwave) starts.
    2.  **Persistence**: It stays active. The HUD shows a "Heatwave" icon.
    3.  **Penalty**: Every swipe (turn), you lose -5 Health and -5 Budget.
    4.  **Resolution**: You must find a **Solution Card** (Blue Border) like "District Cooling" to end the crisis.

This forces players to prioritize **Resilience** over standard growth during emergencies.

## 3. Visual Polish
- **HUD**: Now displays "Active Status" tickers for ongoing penalties.
- **3D City**: The sky turns red/orange during heatwaves, or dark/stormy during floods.
- **Fonts**: Updated entire app to use **Outfit** (modern, geometric) for headers and **Inter** for readability.

## 4. Mobile & UI Fixes
- **3D Camera**: Implemented auto-scaling for mobile portrait screens (camera moves back to fit city).
- **Navigation**: Added circular "Back" buttons to all sub-screens (Leaderboard, ImpactLedger).
- **Press Conference**: Added 13 new topics and capped them to 2 per game to ensure pacing.
